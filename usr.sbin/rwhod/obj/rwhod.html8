<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Copyright (c) 1983, 1991, 1993
  	The Regents of the University of California.  All rights reserved.
  
   Redistribution and use in source and binary forms, with or without
   modification, are permitted provided that the following conditions
   are met:
   1. Redistributions of source code must retain the above copyright
      notice, this list of conditions and the following disclaimer.
   2. Redistributions in binary form must reproduce the above copyright
      notice, this list of conditions and the following disclaimer in the
      documentation and/or other materials provided with the distribution.
   3. Neither the name of the University nor the names of its contributors
      may be used to endorse or promote products derived from this software
      without specific prior written permission.
  
   THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
   ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
   IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
   ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
   FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
   DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
   OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
   HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
   LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
   OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
   SUCH DAMAGE.
  
       from: @(#)rwhod.8	8.2 (Berkeley) 12/11/93
  	$NetBSD: rwhod.8,v 1.20 2005/09/12 18:33:56 wiz Exp $
   -->
<head>
  <meta charset="utf-8"/>
  <link rel="stylesheet" href="../style.css" type="text/css" media="all"/>
  <title>RWHOD(8)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">RWHOD(8)</td>
    <td class="head-vol">System Manager's Manual</td>
    <td class="head-rtitle">RWHOD(8)</td>
  </tr>
</table>
<div class="manual-text">
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<code class="Nm">rwhod</code> &#x2014;
<div class="Nd">system status server</div>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<table class="Nm">
  <tr>
    <td><code class="Nm">rwhod</code></td>
    <td>[<code class="Fl">-i</code> <var class="Ar">interval</var>]
      [<code class="Fl">-u</code> <var class="Ar">user</var>]</td>
  </tr>
</table>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<code class="Nm">rwhod</code> is the server which maintains the database used by
  the <a class="Xr" href="../html1/rwho.html">rwho(1)</a> and
  <a class="Xr" href="../html1/ruptime.html">ruptime(1)</a> programs. Its
  operation is predicated on the ability to <i class="Em">broadcast</i> messages
  on a network.
<p class="Pp">The following options are available:</p>
<dl class="Bl-tag">
  <dt><a class="permalink" href="#i"><code class="Fl" id="i">-i</code></a>
    <var class="Ar">interval</var></dt>
  <dd>Allows for the broadcast interval to be changed from the default 3
      minutes. The <var class="Ar">interval</var> argument is the number of
      seconds to change the interval to, or if the value is suffixed by
      &#x201C;m&#x201D; then it is interpreted as minutes. The maximum allowed
      value for the broadcast interval is 11 minutes because higher values will
      cause <a class="Xr" href="../html1/ruptime.html">ruptime(1)</a> to mark
      the host as being down.</dd>
  <dt><a class="permalink" href="#u"><code class="Fl" id="u">-u</code></a>
    <var class="Ar">user</var></dt>
  <dd>Drop privileges and become the user <var class="Ar">user</var>.</dd>
</dl>
<p class="Pp"><code class="Nm">rwhod</code> operates as both a producer and
    consumer of status information. As a producer of information it periodically
    queries the state of the system and constructs status messages which are
    broadcast on a network. As a consumer of information, it listens for other
    <code class="Nm">rwhod</code> servers' status messages, validating them,
    then recording them in a collection of files located in the directory
    <span class="Pa">/var/rwho</span>.</p>
<p class="Pp">The server transmits and receives messages at the port indicated
    in the &#x201C;who&#x201D; service specification; see
    <a class="Xr" href="../html5/services.html">services(5)</a>. The messages
    sent and received, are of the form:</p>
<div class="Bd Pp Bd-indent">
<pre>
struct	outmp {
	char	out_line[8];		/* tty name */
	char	out_name[8];		/* user id */
	int32_t	out_time;		/* time on */
};

struct	whod {
	char	wd_vers;
	char	wd_type;
	char	wd_fill[2];
	int32_t	wd_sendtime;
	int32_t	wd_recvtime;
	char	wd_hostname[32];
	int32_t	wd_loadav[3];
	int32_t	wd_boottime;
	struct	whoent {
		struct	outmp we_utmp;
		int32_t	we_idle;
	} wd_we[1024 / sizeof (struct whoent)];
};
</pre>
</div>
<p class="Pp">All fields are converted to network byte order prior to
    transmission. The load averages are as calculated by the
    <a class="Xr" href="../html1/w.html">w(1)</a> program, and represent load
    averages over the 5, 10, and 15 minute intervals prior to a server's
    transmission; they are multiplied by 100 for representation in an integer.
    The host name included is that returned by the
    <a class="Xr" href="../html3/gethostname.html">gethostname(3)</a> function
    call, with any trailing domain name omitted. The array at the end of the
    message contains information about the users logged in to the sending
    machine. This information includes the contents of the
    <a class="Xr" href="../html5/utmp.html">utmp(5)</a> entry for each non-idle
    terminal line and a value indicating the time in seconds since a character
    was last received on the terminal line.</p>
<p class="Pp">Messages received by the
    <a class="Xr" href="../html1/rwho.html">rwho(1)</a> server are discarded
    unless they originated at an
    <a class="Xr" href="../html1/rwho.html">rwho(1)</a> server's port. In
    addition, if the host's name, as specified in the message, contains any
    unprintable ASCII characters, the message is discarded. Valid messages
    received by <code class="Nm">rwhod</code> are placed in files named
    <span class="Pa">whod.hostname</span> in the directory
    <span class="Pa">/var/rwho</span>. These files contain only the most recent
    message, in the format described above.</p>
<p class="Pp">Status messages are generated by default approximately once every
    3 minutes.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<a class="Xr" href="../html1/ruptime.html">ruptime(1)</a>,
  <a class="Xr" href="../html1/rwho.html">rwho(1)</a>
</section>
<section class="Sh">
<h1 class="Sh" id="HISTORY"><a class="permalink" href="#HISTORY">HISTORY</a></h1>
The <code class="Nm">rwhod</code> command appeared in
  <span class="Ux">4.2BSD</span>.
</section>
<section class="Sh">
<h1 class="Sh" id="BUGS"><a class="permalink" href="#BUGS">BUGS</a></h1>
There should be a way to relay status information between networks. Status
  information should be sent only upon request rather than continuously. People
  often interpret the server dying or network communication failures as a
  machine going down.
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">September 12, 2005</td>
    <td class="foot-os">NetBSD 10.99</td>
  </tr>
</table>
</body>
</html>
